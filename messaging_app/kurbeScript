#!/bin/bash

# Kubernetes Setup Script
# Task 0: Install Kubernetes and Set Up a Local Cluster

set -e

echo "ğŸš€ Starting Kubernetes setup..."

# Check if minikube is installed
if ! command -v minikube &> /dev/null; then
    echo "âŒ Minikube is not installed. Installing minikube..."
    
    # Install minikube on macOS
    curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64
    sudo install minikube-darwin-amd64 /usr/local/bin/minikube
    rm minikube-darwin-amd64
    
    echo "âœ… Minikube installed successfully!"
else
    echo "âœ… Minikube is already installed!"
fi

# Check if kubectl is installed
if ! command -v kubectl &> /dev/null; then
    echo "âŒ kubectl is not installed. Installing kubectl..."
    
    # Install kubectl on macOS
    curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/darwin/amd64/kubectl"
    chmod +x kubectl
    sudo mv kubectl /usr/local/bin/
    
    echo "âœ… kubectl installed successfully!"
else
    echo "âœ… kubectl is already installed!"
fi

# Start minikube cluster
echo "ğŸš€ Starting minikube cluster..."
minikube start --driver=docker --cpus=2 --memory=2048mb

echo "â³ Waiting for cluster to be ready..."
sleep 10

# Verify cluster is running
echo "ğŸ” Verifying cluster status..."
kubectl cluster-info

echo "ğŸ“‹ Getting available pods..."
kubectl get pods --all-namespaces

echo "ğŸ‰ Kubernetes cluster setup completed successfully!"
echo "You can now deploy applications to your local Kubernetes cluster."
